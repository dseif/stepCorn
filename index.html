<!DOCTYPE html>
<html>
<head>
  <title>StepCorn</title>
  <script src="popcorn/popcorn.js"></script>
  <script src="popcorn/popcorn.parserSM.js"></script>
  <script>
    Popcorn(function() {

      var popcorn = Popcorn( "#stepCorn", {
        frameAnimation: true
      }),
      stepsLeft = document.getElementById( "stepsLeft" ),
      stepsDown= document.getElementById( "stepsDown" ),
      stepsUp = document.getElementById( "stepsUp" ),
      stepsRight = document.getElementById( "stepsRight" ),
      steps = document.getElementById( "steps" ),
      keysDown = [ false, false, false, false ],
      arrowsPressed = {

        37: function( val )  {
          keysDown[ 0 ] = val;
          stepsLeft.innerHTML = +val; 
        },
        38: function( val ) {
          keysDown[ 1 ] = val;
          stepsUp.innerHTML = +val;
        },
        39: function( val ) {
          keysDown[ 2 ] = val;
          stepsRight.innerHTML = +val;
        },
        40: function( val ) {
          keysDown[ 3 ] = val; 
          stepsDown.innerHTML = +val; 
        }
      },
      keyPress = function( keyCode, pressed ) {

        arrowsPressed[ keyCode ] && arrowsPressed[ keyCode ]( pressed );
      };
      
      window.addEventListener( "keydown", function( event ) {

        keyPress( event.keyCode, true );
      });

      window.addEventListener( "keyup", function( event ) {

        keyPress( event.keyCode, false );
      });

      popcorn.listen( "canplayall", function() {

        // Neccissary in order for seeking backwards
        popcorn.exec( 0, function() {

          steps.innerHTML = "0000";
        });

        popcorn.parseSM( "stepfiles/nirvanaDestiny.sm", function( data ) { 

          var beatRate = data[ 0 ].beatRate;

          for( var i = data[ 0 ].start; i < popcorn.duration(); i += beatRate ) {

            popcorn.exec( i, function() {

              // call pulse method here
            });
          }

          for( var i = 0, l = data.length; i < l; i++ ) {

            (function( count ) {

              popcorn.exec( data[ count ].start, function() {

                steps.innerHTML = data[ count ].note;
              });
            })( i )
          }
        });
      });
    });
  </script>
</head>
<body>
  <h1>User Arrows</h1>
  <div id="userSteps">
    <h2 id="stepsLeft" style="display:inline-block">0</h2>
    <h2 id="stepsDown" style="display:inline-block">0</h2>
    <h2 id="stepsUp" style="display:inline-block">0</h2>
    <h2 id="stepsRight" style="display:inline-block">0</h2>
  </div>
  <h1>Scrolling Arrows</h1>
  <h2 id="steps">0000</h2>
  <div>
    <audio id="stepCorn" controls> 
      <source src="songs/nirvanaDestiny.ogg" />
      <p>Your user agent does not support the HTML5 Video element.</p> 
    </audio> 
  </div>
</body>
</html>
